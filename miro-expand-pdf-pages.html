<!DOCTYPE html>
<html>
<head>
  <title>Miro PDF Copier</title>
  <script src="https://sdk.miro.com/1.0.0/miro.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
</head>
<body>
  <script>
    async function getPdfPageCount(pdfUrl) {
      const loadingTask = pdfjsLib.getDocument(pdfUrl);
      const pdf = await loadingTask.promise;
      return pdf.numPages;
    }

    async function copySelectedPdfPreview() {
      const selectedWidgets = await miro.board.selection.get();
      if (selectedWidgets.length === 0) {
        alert('Выберите PDF-превью на доске.');
        return;
      }

      const pdfWidget = selectedWidgets[0];
      if (pdfWidget.type !== 'image') {
        alert('Выберите корректное PDF-превью.');
        return;
      }

      const pdfUrl = pdfWidget.url;
      const pageCount = await getPdfPageCount(pdfUrl);
      const items = [];
      const xStart = pdfWidget.x;
      const yStart = pdfWidget.y;
      const xOffset = 100; // Расстояние между копиями по горизонтали
      const yOffset = 100; // Расстояние между копиями по вертикали

      for (let i = 1; i < pageCount; i++) {
        items.push({
          type: 'image',
          url: pdfUrl,
          x: xStart + i * xOffset,
          y: yStart + i * yOffset,
          title: `Page ${i + 1}`
        });
      }

      await miro.board.widgets.create(items);
      alert(`Создано ${pageCount - 1} копий PDF-превью.`);
    }

    miro.onReady(() => {
      miro.initialize({
        extensionPoints: {
          toolbar: {
            title: 'Copy PDF Preview',
            svgIcon: '<svg viewBox="0 0 24 24"><path fill="currentColor" d="M19 3H14.82C14.4 1.84 13.3 1 12 1C10.7 1 9.6 1.84 9.18 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M12 3C12.55 3 13 3.45 13 4C13 4.55 12.55 5 12 5C11.45 5 11 4.55 11 4C11 3.45 11.45 3 12 3M15 18H9V16H15V18M17 14H7V12H17V14M17 10H7V8H17V10Z" /></svg>', // Добавьте SVG иконку
            librarySvgIcon: '<svg viewBox="0 0 24 24"><path fill="currentColor" d="M19 3H14.82C14.4 1.84 13.3 1 12 1C10.7 1 9.6 1.84 9.18 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M12 3C12.55 3 13 3.45 13 4C13 4.55 12.55 5 12 5C11.45 5 11 4.55 11 4C11 3.45 11.45 3 12 3M15 18H9V16H15V18M17 14H7V12H17V14M17 10H7V8H17V10Z" /></svg>', // Добавьте SVG иконку для библиотеки
            onClick: async () => {
              await copySelectedPdfPreview();
            }
          }
        }
      });
    });
  </script>
</body>
</html>